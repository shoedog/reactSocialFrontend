<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/server/server.jsx | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/andrew310/cs419-frontend" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">server</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PORT">PORT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-app">app</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-history">history</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">shared</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-rootReducer">rootReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Color">Color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Type">Type</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-blue">blue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sans">sans</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-serif">serif</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">shared/Containers</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-App">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-styles">styles</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Nav">Nav</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-styles">styles</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">shared/actions</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createTodo">createTodo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-deleteTodo">deleteTodo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-editTodo">editTodo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getTodos">getTodos</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_URL">API_URL</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">shared/components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/shared/components/TodosForm.jsx~TodosForm.html">TodosForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/shared/components/TodosHome.jsx~Home.html">Home</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/shared/components/TodosView.jsx~TodosView.html">TodosView</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">shared/lib</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-fetchComponentData">fetchComponentData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-immutifyState">immutifyState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-promiseMiddleware">promiseMiddleware</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">shared/reducers</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-todoReducer">todoReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-defaultState">defaultState</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/server/server.jsx</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import express from &apos;express&apos;;
import React from &apos;react&apos;;

//Axios is a promise based HTTP client we use for async requests
import axios from &apos;axios&apos;;

// Need to render to string on server and to send string to client
import { renderToString } from &apos;react-dom/server&apos;

// Routes and History using react-router
import { createMemoryHistory, RouterContext, match } from &apos;react-router&apos;;
//import createHistory from &apos;history/createMemoryHistory&apos;;
import routes from &apos;../shared/routes&apos;;

// Redux Imports
//
import { createStore, applyMiddleware } from &apos;redux&apos;;
import { Provider } from &apos;react-redux&apos;;
import rootReducer from &apos;../shared/rootReducer.js&apos;;

// Middleware for async actions + applyMiddleware import from &apos;redux&apos;
import promiseMiddleware from &apos;lib/promiseMiddleware&apos;;

// Handles State Rehydration
import fetchComponentData from &apos;lib/fetchComponentData&apos;;

//Inline Styling
import { StyleSheetServer } from &apos;aphrodite&apos;

const app = express();
const history = createMemoryHistory();
const PORT = process.env.PORT || 3000;

app.use((req, res) =&gt; {
  const reducer  = rootReducer;

  // Async middleware applied same as in client except without initialState
  const store = applyMiddleware(promiseMiddleware)(createStore)(reducer);

  /*
   * From the react-router docs:
   *
   * This function is to be used for server-side rendering. It matches a set of routes to
   * a location, without rendering, and calls a callback(err, redirect, props)
   * when it&apos;s done.
   *
   * The function will create a `history` for you, passing additional `options` to create it.
   * These options can include `basename` to control the base name for URLs, as well as the pair
   * of `parseQueryString` and `stringifyQuery` to control query string parsing and serializing.
   * You can also pass in an already instantiated `history` object, which can be constructured
   * however you like.
   *
   * The three arguments to the callback function you pass to `match` are:
   * - err:       A javascript Error object if an error occured, `undefined` otherwise.
   * - redirect:  A `Location` object if the route is a redirect, `undefined` otherwise
   * - props:     The props you should pass to the routing context if the route matched,
   *              `undefined` otherwise.
   * If all three parameters are `undefined`, this means that there was no route found matching the
   * given location.
   */
  match({ routes, location: req.url }, (err, redirectLocation, renderProps) =&gt; {
    if (err) {
      console.error(err);
      return res.status(500).end(&apos;Internal server error&apos;);
    }
    if (!renderProps) return res.status(404).end(&apos;Not found.&apos;);

    /**
     * We create a new instance of a Redux store on every request, and inject that through the component tree
     * (available as &lt;component&gt;.context.redux, if you ever want to access it directly)
     * by wrapping the root component in Provider.
     */
    function renderView() {
      const InitialView = (
        &lt;Provider store={store}&gt;
          &lt;RouterContext {...renderProps} /&gt;
        &lt;/Provider&gt;
      );

      // We&#x2019;ll also want to pass an initial state to the client, so it can hydrate its stores.
      const initialState = store.getState();

      const componentHTML = StyleSheetServer.renderStatic(
        () =&gt; renderToString(InitialView)
      )
      const HTML = `
        &lt;!DOCTYPE html&gt;
        &lt;html&gt;
          &lt;head&gt;
            &lt;meta charset=&quot;utf-8&quot;&gt;
            &lt;title&gt;Isomorphic Redux Demo&lt;/title&gt;
            &lt;style&gt;
                  html {
                    box-sizing: border-box
                  }
                  *,
                  *::before,
                  *::after {
                    box-sizing: border-box
                  }
                  html {
                    font-size: 100%;
                    -ms-overflow-style: scrollbar;
                    -webkit-tap-highlight-color: rgba(0,0,0,0);
                    height: 100%;
                  }
                  body {
                    font-size: 1rem;
                    background-color: #fff;
                    color: #555;
                    -webkit-font-smoothing: antialiased;
                    -moz-osx-font-smoothing: grayscale;
                    font-family: -apple-system,BlinkMacSystemFont,&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;
                    margin: 0;
                  }
                  h1,h2,h3,h4,h5,h6 {
                    margin: 0;
                    padding: 0;
                  }
                &lt;/style&gt;
                &lt;style data-aphrodite&gt;${componentHTML.css.content}&lt;/style&gt;
          &lt;/head&gt;
          &lt;body&gt;
            &lt;div id=&quot;app&quot;&gt;${componentHTML.html}&lt;/div&gt;
            &lt;script&gt;window.renderedClassNames = ${JSON.stringify(componentHTML.css.renderedClassNames)};&lt;/script&gt;
            &lt;!-- This sends the state to the client --&gt;
            &lt;script&gt;window.__INITIAL_STATE__ = ${JSON.stringify(initialState)};&lt;/script&gt;
            &lt;script type=&quot;application/javascript&quot; src=&quot;/bundle.js&quot;&gt;&lt;/script&gt;
          &lt;/body&gt;
      &lt;/html&gt;
    `;
      return HTML;
    }

    fetchComponentData(store.dispatch, renderProps.components, renderProps.params)
      .then(renderView)
      .then(html =&gt; res.end(html))
      .catch(err =&gt; res.end(err.message));
  });
});


app.listen(PORT, () =&gt; {
  console.log(`Server listening on: ${PORT}`);
});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
